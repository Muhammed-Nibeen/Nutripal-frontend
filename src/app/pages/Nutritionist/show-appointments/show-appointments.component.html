<app-nutridash></app-nutridash>

<div class="main">
  <div class="main-section w-full lg:w-3/4 xl:w-2/3 p-8 flex flex-col items-center justify-center mb-20">
    <h2 class="text-2xl font-bold mb-4 text-indigo-500">Scheduled Slots</h2>
    <div class="main-content overflow-x-auto">
      <table class="min-w-full mb-20">
        <thead>
          <tr>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs leading-4 font-semibold text-gray-500 uppercase tracking-wider">No</th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs leading-4 font-semibold text-gray-500 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs leading-4 font-semibold text-gray-500 uppercase tracking-wider">Time</th>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs leading-4 font-semibold text-gray-500 uppercase tracking-wider">Status</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let appointment of Appointments; let i = index">
            <td class="px-6 py-4 whitespace-no-wrap">{{ i + 1 }}</td>
            <td class="px-6 py-4 whitespace-no-wrap">{{ appointment.date | date: 'yyyy-MM-dd' }}</td>
            <td class="px-6 py-4 whitespace-no-wrap">{{ appointment.time }}</td>
            <td class="px-6 py-4 whitespace-no-wrap">{{ appointment.status }}</td>
            <td class="px-6 py-4 whitespace-no-wrap" *ngIf="appointment.status === 'booked'">
              <button type="button" class="px-3 py-2 text-sm font-medium text-center cursor-pointer text-white bg-green-500 rounded-lg border-none hover:bg-green-600 focus:ring-4 focus:outline-none" (click)="showInfo(appointment._id)">Show Info</button>
            </td>
            <td class="px-6 py-4 whitespace-no-wrap" *ngIf="appointment.status === 'booked'">
              <span *ngIf="unreadmessageCount[appointment.user_id] && unreadmessageCount[appointment.user_id] > 0" class="ml-5 bg-yellow-400 text-gray-800 px-2 py-1 rounded-full text-xs">{{ unreadmessageCount[appointment.user_id] }}</span>
              <button (click)="chat(appointment.user_id)" class="chatBtn">
                <svg height="1.6em" fill="white" xml:space="preserve" viewBox="0 0 1000 1000" y="0px" x="0px" version="1.1">
                  <path d="M881.1,720.5H434.7L173.3,941V720.5h-54.4C58.8,720.5,10,671.1,10,610.2v-441C10,108.4,58.8,59,118.9,59h762.2C941.2,59,990,108.4,990,169.3v441C990,671.1,941.2,720.5,881.1,720.5L881.1,720.5z M935.6,169.3c0-30.4-24.4-55.2-54.5-55.2H118.9c-30.1,0-54.5,24.7-54.5,55.2v441c0,30.4,24.4,55.1,54.5,55.1h54.4h54.4v110.3l163.3-110.2H500h381.1c30.1,0,54.5-24.7,54.5-55.1V169.3L935.6,169.3z M717.8,444.8c-30.1,0-54.4-24.7-54.4-55.1c0-30.4,24.3-55.2,54.4-55.2c30.1,0,54.5,24.7,54.5,55.2C772.2,420.2,747.8,444.8,717.8,444.8L717.8,444.8z M500,444.8c-30.1,0-54.4-24.7-54.4-55.1c0-30.4,24.3-55.2,54.4-55.2c30.1,0,54.4,24.7,54.4,55.2C554.4,420.2,530.1,444.8,500,444.8L500,444.8z M282.2,444.8c-30.1,0-54.5-24.7-54.5-55.1c0-30.4,24.4-55.2,54.5-55.2c30.1,0,54.4,24.7,54.4,55.2C336.7,420.2,312.3,444.8,282.2,444.8L282.2,444.8z"></path>
                </svg>
                <span class="tooltip">Chat</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card flex justify-content-center">
  <p-dialog *ngIf="userDetails" header="Details" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
    <span class="p-text-secondary block mb-5">View user details.</span>
    <div class="flex align-items-center gap-3 mb-3">
      <label for="username" class="font-semibold w-6rem">Username</label>
      <label for="username" class="font-semibold w-6rem">{{ userDetails.email }}</label>
    </div>
    <div class="flex align-items-center gap-3 mb-5">
      <label for="email" class="font-semibold w-6rem">Email</label>
      <label for="username" class="font-semibold w-6rem">{{ userDetails.fullName }}</label>
    </div>
    <div class="flex justify-content-end gap-2">
      <p-button label="Cancel" severity="secondary" (click)="visible = false" />
    </div>
  </p-dialog>
</div>
